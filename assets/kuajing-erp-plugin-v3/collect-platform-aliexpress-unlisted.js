var te=Object.defineProperty;var ne=(w,m,E)=>m in w?te(w,m,{enumerable:!0,configurable:!0,writable:!0,value:E}):w[m]=E;var J=(w,m,E)=>ne(w,typeof m!="symbol"?m+"":m,E);var collectPlatformAliexpressUnlisted=(function(){"use strict";function w(e){return e==null||typeof e=="function"?{main:e}:e}const m=[EvalError,RangeError,ReferenceError,SyntaxError,TypeError,URIError,globalThis.DOMException,globalThis.AssertionError,globalThis.SystemError].filter(Boolean).map(e=>[e.name,e]),E=new Map(m);class M extends Error{constructor(r){super(M._prepareSuperMessage(r));J(this,"name","NonError")}static _prepareSuperMessage(r){try{return JSON.stringify(r)}catch{return String(r)}}}const k=[{property:"name",enumerable:!1},{property:"message",enumerable:!1},{property:"stack",enumerable:!1},{property:"code",enumerable:!0},{property:"cause",enumerable:!1}],O=new WeakSet,B=e=>{O.add(e);const t=e.toJSON();return O.delete(e),t},S=e=>E.get(e)??Error,I=({from:e,seen:t,to:r,forceEnumerable:s,maxDepth:u,depth:d,useToJSON:o,serialize:a})=>{if(!r)if(Array.isArray(e))r=[];else if(!a&&L(e)){const n=S(e.name);r=new n}else r={};if(t.push(e),d>=u)return r;if(o&&typeof e.toJSON=="function"&&!O.has(e))return B(e);const i=n=>I({from:n,seen:[...t],forceEnumerable:s,maxDepth:u,depth:d,useToJSON:o,serialize:a});for(const[n,c]of Object.entries(e)){if(c&&c instanceof Uint8Array&&c.constructor.name==="Buffer"){r[n]="[object Buffer]";continue}if(c!==null&&typeof c=="object"&&typeof c.pipe=="function"){r[n]="[object Stream]";continue}if(typeof c!="function"){if(!c||typeof c!="object"){try{r[n]=c}catch{}continue}if(!t.includes(e[n])){d++,r[n]=i(e[n]);continue}r[n]="[Circular]"}}for(const{property:n,enumerable:c}of k)typeof e[n]<"u"&&e[n]!==null&&Object.defineProperty(r,n,{value:L(e[n])?i(e[n]):e[n],enumerable:s?!0:c,configurable:!0,writable:!0});return r};function F(e,t={}){const{maxDepth:r=Number.POSITIVE_INFINITY,useToJSON:s=!0}=t;return typeof e=="object"&&e!==null?I({from:e,seen:[],forceEnumerable:!0,maxDepth:r,depth:0,useToJSON:s,serialize:!0}):typeof e=="function"?`[Function: ${e.name||"anonymous"}]`:e}function z(e,t={}){const{maxDepth:r=Number.POSITIVE_INFINITY}=t;if(e instanceof Error)return e;if(X(e)){const s=S(e.name);return I({from:e,seen:[],to:new s,maxDepth:r,depth:0,serialize:!1})}return new M(e)}function L(e){return!!e&&typeof e=="object"&&"name"in e&&"message"in e&&"stack"in e}function X(e){return!!e&&typeof e=="object"&&"message"in e&&!Array.isArray(e)}var V=Object.defineProperty,W=Object.defineProperties,Y=Object.getOwnPropertyDescriptors,j=Object.getOwnPropertySymbols,H=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable,D=(e,t,r)=>t in e?V(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,R=(e,t)=>{for(var r in t||(t={}))H.call(t,r)&&D(e,r,t[r]);if(j)for(var r of j(t))G.call(t,r)&&D(e,r,t[r]);return e},N=(e,t)=>W(e,Y(t)),T=(e,t,r)=>new Promise((s,u)=>{var d=i=>{try{a(r.next(i))}catch(n){u(n)}},o=i=>{try{a(r.throw(i))}catch(n){u(n)}},a=i=>i.done?s(i.value):Promise.resolve(i.value).then(d,o);a((r=r.apply(e,t)).next())});function Q(e){let t,r={};function s(){Object.entries(r).length===0&&(t==null||t(),t=void 0)}let u=Math.floor(Math.random()*1e4);function d(){return u++}return{sendMessage(o,a,...i){return T(this,null,function*(){var n,c,l,h;const y={id:d(),type:o,data:a,timestamp:Date.now()},f=(c=yield(n=e.verifyMessageData)==null?void 0:n.call(e,y))!=null?c:y;(l=e.logger)==null||l.debug(`[messaging] sendMessage {id=${f.id}} ─ᐅ`,f,...i);const P=yield e.sendMessage(f,...i),{res:p,err:g}=P??{err:new Error("No response")};if((h=e.logger)==null||h.debug(`[messaging] sendMessage {id=${f.id}} ᐊ─`,{res:p,err:g}),g!=null)throw z(g);return p})},onMessage(o,a){var i,n,c;if(t==null&&((i=e.logger)==null||i.debug(`[messaging] "${o}" initialized the message listener for this context`),t=e.addRootListener(l=>{var h,y;if(typeof l.type!="string"||typeof l.timestamp!="number"){if(e.breakError)return;const p=Error(`[messaging] Unknown message format, must include the 'type' & 'timestamp' fields, received: ${JSON.stringify(l)}`);throw(h=e.logger)==null||h.error(p),p}(y=e==null?void 0:e.logger)==null||y.debug("[messaging] Received message",l);const f=r[l.type];if(f==null)return;const P=f(l);return Promise.resolve(P).then(p=>{var g,q;return(q=(g=e.verifyMessageData)==null?void 0:g.call(e,p))!=null?q:p}).then(p=>{var g;return(g=e==null?void 0:e.logger)==null||g.debug(`[messaging] onMessage {id=${l.id}} ─ᐅ`,{res:p}),{res:p}}).catch(p=>{var g;return(g=e==null?void 0:e.logger)==null||g.debug(`[messaging] onMessage {id=${l.id}} ─ᐅ`,{err:p}),{err:F(p)}})})),r[o]!=null){const l=Error(`[messaging] In this JS context, only one listener can be setup for ${o}`);throw(n=e.logger)==null||n.error(l),l}return r[o]=a,(c=e.logger)==null||c.log(`[messaging] Added listener for ${o}`),()=>{delete r[o],s()}},removeAllListeners(){Object.keys(r).forEach(o=>{delete r[o]}),s()}}}for(var x=256,A=[],C=256,_;x--;)A[x]=(x+256).toString(16).substring(1);function Z(e){var t=0,r=11;if(!_||x+r>C*2)for(_="",x=0;t<C;t++)_+=A[Math.random()*256|0];return _.substring(x,x+++r)}var $="@webext-core/messaging/window",U="@webext-core/messaging/window/response";function K(e){const t=e.namespace,r=Z();let s=[];const u=(o,a)=>new Promise(i=>{const n=l=>{l.data.type===U&&l.data.namespace===t&&l.data.instanceId!==r&&l.data.message.type===o.type&&(i(l.data.response),c())},c=()=>window.removeEventListener("message",n);s.push(c),window.addEventListener("message",n),window.postMessage({type:$,message:o,senderOrigin:location.origin,namespace:t,instanceId:r},a??"*")}),d=Q(N(R({},e),{sendMessage(o,a){return u(o,a)},addRootListener(o){const a=i=>T(this,null,function*(){if(i.data.type!==$||i.data.namespace!==t||i.data.instanceId===r)return;const n=yield o(i.data.message);window.postMessage({type:U,response:n,instanceId:r,message:i.data.message,namespace:t},i.data.senderOrigin)});return window.addEventListener("message",a),()=>window.removeEventListener("message",a)},verifyMessageData(o){return structuredClone(o)}}));return N(R({},d),{removeAllListeners(){d.removeAllListeners(),s.forEach(o=>o()),s=[]}})}const b=K({namespace:"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"}),ee=w({main(){const e=s=>s?["mtop.aliexpress.itemdetail.pc.asyncpcdetail","mtop.aliexpress.pdp.pc.query"].some(u=>u.toLowerCase()===s.toLowerCase()):!1;b.onMessage("getPcItemDetail",()=>{var o,a,i,n;const s=(o=window._page_config_)==null?void 0:o.prefetch,u=(n=(i=(a=window._d_c_)==null?void 0:a.lifeCycleEventList)==null?void 0:i[0])==null?void 0:n.data;if(u){b.sendMessage("sendPcItemDetail",{api:s.api,data:{result:u}});return}if(e(s==null?void 0:s.api)){const c=window.lib.mtop.request(s),l=((s==null?void 0:s.timeout)||15e3)+1e3,h=new Promise((y,f)=>{setTimeout(()=>f(new Error("Request timeout")),l)});Promise.race([c,h]).then(y=>{b.sendMessage("sendPcItemDetail",y)}).catch(()=>{b.sendMessage("sendPcItemDetail",{})})}else b.sendMessage("sendPcItemDetail",{})});const t=fetch;window.fetch=async function(){var u;const s=await t(...arguments);try{const d=arguments[0];(u=d.includes)!=null&&u.call(d,"/bx/pdp/web/productData?productId=")&&s.clone().json().then(a=>{b.sendMessage("getRuPcItemDetail",a)})}catch{}return s};const r=Object.getOwnPropertyDescriptor(XMLHttpRequest.prototype,"responseText");Object.defineProperty(XMLHttpRequest.prototype,"responseText",{get(){const s=r.get.call(this),u=this.responseURL,d=new RegExp("product/description/pc/v2(/(\\w|\\d|-|_)+)?/desc\\.htm");try{d.test(u)&&b.sendMessage("getDescription",s)}catch{}return s}})}});function se(){}function v(e,...t){}const re={debug:(...e)=>v(console.debug,...e),log:(...e)=>v(console.log,...e),warn:(...e)=>v(console.warn,...e),error:(...e)=>v(console.error,...e)};return(async()=>{try{return await ee.main()}catch(e){throw re.error('The unlisted script "collect-platform-aliexpress-unlisted" crashed on startup!',e),e}})()})();
collectPlatformAliexpressUnlisted;